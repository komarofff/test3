<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Recruitment task</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
</head>
<body>
<div id="app">


    <div style="display: grid; grid-template-columns: repeat(3,1fr); grid-gap: 2em;">
        <div>
            <h1>TODO</h1>
            <ol>
                <template v-for="task in taskList">
                    <task-item :task="task">
                        <ol type="a" v-if="task.subtaskList">
                            <template v-for="subtask in task.subtaskList">
                                <task-item :task="subtask"></task-item>
                            </template>
                        </ol>
                    </task-item>
                </template>
            </ol>
            <h2>Hints</h2>
            <ol>
                <li>
                    yarn global add browser-sync<br>
                    browser-sync --watch .
                </li>
                <li>&lt;datalist&gt;</li>
            </ol>
        </div>

        <div>
            <div>
                <h2>Add new worker</h2>
                <form @submit.prevent="AddNewWorker">
                    <fieldset>
                        <p><label>Name</label><br>
                            <input type="text" v-model="name" required></p>
                        <p><label>Surname</label><br>
                            <input type="text" v-model="surname" required></p>
                        <p><label>Department</label><br>
                            <select v-model="department">
                                <option v-for="dep in departmentList" required>{{ dep }}</option>
                            </select>
                            <!--                            <br>-->
                            <!--                        <label>Dont see your department? Add new</label><br>-->
                            <!--                            <input type="text" v-model="newDepartment">-->
                        </p>
                        <p><label>Salary</label><br>
                            <input type="number" v-model="salary" required></p>
                        <p><label>Currency</label><br>
                            <select v-model="currency" required>
                                <option v-for="cur in currencyList">{{ cur }}</option>
                            </select></p>
                        <p>
                            <button type="submit">Add</button>
                        </p>
                    </fieldset>
                </form>
                <h2 v-if="error" style="color:red">Something wrong! </h2>
            </div>
            <h2>Workers</h2>
            <table border="1">
                <tbody>
                <tr v-for="(worker, index) in workerList" :key="worker.id">
                    <td>{{index + 1}}.</td>
                    <td>{{worker.firstName}}</td>
                    <td>{{worker.lastName}}</td>
                    <td>{{worker.department}}</td>
                    <td>{{worker.salary.amount}} {{worker.salary.currency}}</td>
                </tr>
                </tbody>
                <tfoot>
                <tr v-for="total in salarySum">
                    <td colspan="3"></td>
                    <td>Total in {{ total.currency}}</td>
                    <td>{{ total.total}}</td>
                </tr>
                </tfoot>
            </table>
            <div>
                <h2>Show salary per department</h2>
                <pre>
<!--                {{ totalCurrency }}-->
                    {{ summaryForAllDepartments}}

                </pre>
            </div>
        </div>


        <div>
            <h2>Search</h2>
        </div>

    </div>
</div>

<script>
    const TaskItem = Vue.component('task-item', {
        props: {
            task: Object
        },
        template: '<li>{{task.title}} {{ task.completed ? "✅" : "❌"}}<slot name="default"></slot></li>'
    });

    new Vue({
        el: "#app",
        components: {
            TaskItem
        },

        data: {
            error: false,
            formValidate: false,
            name: null,
            surname: null,
            salary: 0,
            salarySumForAllCurrencies: [],
            salarySumForDepartments: [],
            currency: null,
            currentCurrency: null,
            currencyName: null,
            departmenName: null,
            newDepartment: null,
            currentDepartment: null,
            department: null,
            departmentList: ["IT", "Sales", "Administration"],
            currencyList: ["USD", "EURO", "PLN"],
            workerList: [
                {
                    "id": 1,
                    "firstName": "John",
                    "lastName": "Smith",
                    "department": "IT",
                    "salary": {"amount": 3000, "currency": "USD"}
                },
                {
                    "id": 2,
                    "firstName": "Jane",
                    "lastName": "Doe",
                    "department": "IT",
                    "salary": {"amount": 3000.50, "currency": "USD"}
                },
                {
                    "id": 3,
                    "firstName": "Bob",
                    "lastName": "Colman",
                    "department": "Sales",
                    "salary": {"amount": 9000, "currency": "USD"}
                },
                {
                    "id": 4,
                    "firstName": "Barbara",
                    "lastName": "O'Connor",
                    "department": "Sales",
                    "salary": {"amount": 4000, "currency": "USD"}
                },
                {
                    "id": 5,
                    "firstName": "Adam",
                    "lastName": "Murphy",
                    "department": "Administration",
                    "salary": {"amount": 2000, "currency": "USD"}
                }
            ],
            taskList: [
                {
                    "title": "Add form to add new worker",
                    "completed": true,
                    "subtaskList": [
                        {"title": "firstName", "completed": true},
                        {"title": "lastName", "completed": true},
                        {"title": "department", "completed": true},
                        {"title": "salary amount and currency", "completed": true}
                    ]
                },
                {
                    "title": "Add search form",
                    "completed": false,
                    "subtaskList": [
                        {"title": "person (text)", "completed": false},
                        {"title": "department (multiple choice)", "completed": false},
                        {"title": "salary (range)", "completed": false}
                    ]
                },
                {
                    "title": "Add summary of salary per department",
                    "completed": false
                },
                {
                    "title": "Other improvements (feel free to add other improvements)",
                    "completed": false
                }
            ],
            salaryDepartment: [],
            totalCurrency: []

        },
        computed: {
            salarySum() {
                this.salarySumForAllCurrencies = []
                this.summaryForAllCurrencies
                this.totalCurrency.forEach((el) => {
                    let cur = el.currency
                    let sal = el.list.reduce((acc, i) => acc + i.salary.amount, 0)
                    this.salarySumForAllCurrencies.push({ "currency" : cur, "total": sal})
                })
                return this.salarySumForAllCurrencies
            },
            departmentSum() {
                this.salarySumForDepartments = []
                this.summaryForAllDepartments
                this.salaryDepartment.forEach((el) => {
                    let cur = el.currency
                    let sal = el.list.reduce((acc, i) => acc + i.salary.amount, 0)
                    this.salarySumForDepartments.push({ "currency" : cur, "total": sal})
                })
                return this.salarySumForDepartments
            },
            getId() {
                return this.workerList.length + 1
            },
            summaryForAllCurrencies() {
                this.totalCurrency = []
                this.currencyList.forEach((el) => {
                    this.currentCurrency = this.workerList.filter((n) => n.salary.currency === el)
                    let currencyIndex = this.currencyList.indexOf(el)
                    this.currencyName = this.currencyList[currencyIndex]
                    if (this.currentCurrency.length > 0) {
                        this.totalCurrency.push({"currency": this.currencyName, "list": this.currentCurrency})
                    }
                })
                return this.totalCurrency
            },
            summaryForAllDepartments() {
                this.salaryDepartment = []
                this.departmentList.forEach((el) => {
                    this.currentDepartment = this.workerList.filter((n) => n.department === el)
                    let departmentIndex = this.departmentList.indexOf(el)
                    this.departmenName = this.departmentList[departmentIndex]
                    if (this.currentDepartment.length > 0) {
                        this.salaryDepartment.push({"department": this.departmenName, "list": this.currentDepartment})
                    }
                })
                return this.salaryDepartment
            },

        },
        methods: {
            AddNewWorker() {
                if (this.name && this.surname && this.department && this.salary && this.currency) {
                    this.formValidate = true
                } else {
                    this.error = true
                }
                if (this.formValidate) {
                    this.workerList.push(
                        {
                            "id": this.getId,
                            "firstName": this.name,
                            "lastName": this.surname,
                            "department": this.department,
                            "salary": {"amount": parseFloat(this.salary), "currency": this.currency}
                        })
                    this.formValidate = false
                    this.error = false
                    this.name = null
                    this.surname = null
                    this.department = null
                    this.salary = null
                    this.currency = null
                }
            }
        }
    });
</script>
</body>
</html>
